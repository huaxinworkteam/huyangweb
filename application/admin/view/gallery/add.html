<body>
	<article class="clearfix pd-20" id="edit">
        <el-form :model="dataForm" label-width="130px" :rules="rules" ref="dataForm">
            <el-form-item label="标题；">
                <el-input v-model="dataForm.title"></el-input>
            </el-form-item>
            <el-form-item label="跳转链接：">
                <el-input v-model="dataForm.link"></el-input>
            </el-form-item>
            <el-form-item label="图片 (nnn*mmm px)：" prop="imgUrl">
                <el-upload drag :action="uploadAction" :show-file-list="false"
                    :on-success="uploadImageSuccess" :on-error="uploadImageError" 
                    :before-upload="beforeImageUpload" accept="image/*">
                    <i class="el-icon-upload" v-show="!dataForm.imgUrl"></i>
                    <img v-show="dataForm.imgUrl" :src="dataForm.imgUrl"  class="el-upload-dragger"/>
                    <div class="el-upload__text"v-show="!dataForm.imgUrl">将文件拖到此处，或<em>点击上传</em></div>
                    <div class="el-upload__tip" slot="tip">图片上传提示</div>
                </el-upload>
                
            </el-form-item>
            <el-form-item label="排序：">
                <el-input-number v-model="dataForm.sort" controls-position="right" :min="0" :max="100"></el-input-number>
            </el-form-item>
            <el-form-item label="状态：">
                <el-switch v-model="dataForm.status" :active-text="dataForm.status? '启用':'禁用'"></el-switch>
              </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm('dataForm')">立即提交</el-button>
                <el-button @click="resetForm('dataForm')">重置</el-button>
            </el-form-item>
        </el-form>
    </article>
    <!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript" src="__ADMIN__/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
	<script type="text/javascript" src="__ADMIN__/lib/jquery.validation/1.14.0/validate-methods.js"></script>
    <script type="text/javascript" src="__ADMIN__/lib/jquery.validation/1.14.0/messages_zh.js"></script>
    <script type="text/javascript">
        new Vue({
            el: '#edit',
            data: function() {
                return {
                    uploadAction: 'https://jsonplaceholder.typicode.com/posts/', // 图片上传服务器地址
                    dataForm: {
                        title: '',
                        webno:{$webno},
                        link: '',
                        imgUrl: null,
                        sort: '',
                        status: true
                    },
                    rules: {
                        imgUrl: [
                            { required: true, message: '请上传图片', trigger: 'blur' }
                        ]
                    },
                    uploadLoading: false
                }
            },
            mounted() {
                console.log(this.dataForm.webno)
            },
            methods: {
                uploadImageSuccess(res, file) {
                    layer.close(this.uploadLoading);
                    layer.msg('上传成功');
                    this.dataForm.imgUrl = URL.createObjectURL(file.raw);
                },
                uploadImageError(err, file) {
                    layer.close(this.uploadLoading);
                    layer.msg('上传失败，原因:'+err);
                },
                beforeImageUpload(file) {
                    // const isJPG = file.type === 'image/jpeg';
                    // const isLt2M = file.size / 1024 / 1024 < 2;

                    // if (!isJPG) {
                    // this.$message.error('上传图片只能是 JPG 格式!');
                    // }
                    // if (!isLt2M) {
                    // this.$message.error('上传图片大小不能超过 2MB!');
                    // }
                    // return isJPG && isLt2M;
                    this.uploadLoading = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
                },
                uploadProgress(file) {
                    
                },

                submitForm(formName) {
                    this.$refs[formName].validate((valid) => {
                        if (valid) {
                            // 提交数据的请求
                        } else {
                            console.log('error submit!!');
                            return false;
                        }
                    });
                },
                resetForm(formName) {
                    this.$refs[formName].resetFields();
                }
            }
        })
    </script>

	<script type="text/javascript">
		$(function () {
			$('#adminadd').click(function () {
				$.ajax({
					url:"{:url('admin/gallery/save')}",
					type:"post",
					data:$('form').serialize(),
					dataType:'json',
					success:function (data) {
						if(data.code==1){
						    layer.msg(data.msg,{
						        icon:6,
								time:2000
							},function () {
								layer_close();
                                parent.location.href=data.url;
                            });
						}else{
						    layer.open({
								title:'图片添加失败',
								content:data.msg,
								icon:5,
								anim:6
							});
						}
                    }
				});
				return false;
            });
        });
	</script>
	<script type="text/javascript">
		$(function(){
			/* 通过iCheck插件，美化checkbox */
			$('.skin-minimal input').iCheck({
				checkboxClass: 'icheckbox-blue',
				radioClass: 'iradio-blue',
				increaseArea: '20%'
			});

			/* 表单验证，提交 */
			$("#form-admin-add").validate({
				rules:{
					username:{
						required:true,
						minlength:4,
						maxlength:16
					},
					nickname:{
                        required:true,
                        maxlength:16
                    },
					password:{
						required:true,
					},
					password2:{
						required:true,
						equalTo: "#password"
					},
					phone:{
						required:true,
						isPhone:true,
					},
					email:{
						required:true,
						email:true,
					},
					is_super:{
						required:true,
					},
				},
				onkeyup:false,
				focusCleanup:true,
				success:"valid",
				submitHandler:function(form){
					$(form).ajaxSubmit();
					var index = parent.layer.getFrameIndex(window.name);
					parent.location.replace(parent.location.href)
					parent.layer.close(index);
				}
			});
		});
	</script>

</body>
